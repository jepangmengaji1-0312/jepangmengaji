<!doctype html>
<html lang="id" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jepang Mengaji ‚Äî Beranda</title>
  <link rel="icon" href="jm.jpeg" />
  <style>
    :root{
      --bg:#ffffff;--bg-soft:#f8fafc;--text:#0f172a;--muted:#475569;
      --card:#fff;--border:#e5e7eb;--primary:#ef4444;--shadow:0 6px 24px rgba(2,6,23,.08);
      /* Ubah ke 'cover' bila ingin poster menutup frame (meski terpotong) */
      --poster-fit: contain;
    }
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Arial;background:var(--bg);color:var(--text)}
    .container{max-width:1180px;margin:0 auto;padding:0 16px}
    a{text-decoration:none;color:inherit}

    /* NAVBAR */
    .nav{position:sticky;top:0;z-index:60;background:rgba(255,255,255,.95);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;gap:10px;align-items:center;font-weight:800}
    .brand img{width:36px;height:36px;border-radius:8px;border:1px solid var(--border)}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.block{width:100%;justify-content:center}

    /* Burger */
    .burger{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:999px;border:1px solid var(--border);background:#fff}
    .burger span{width:18px;height:2px;background:var(--text);position:relative;display:block}
    .burger span::before,.burger span::after{content:"";position:absolute;left:0;width:18px;height:2px;background:var(--text);transition:transform .2s ease,opacity .2s ease}
    .burger span::before{top:-6px}.burger span::after{top:6px}
    .nav.open .burger span{background:transparent}
    .nav.open .burger span::before{transform:translateY(6px) rotate(45deg)}
    .nav.open .burger span::after{transform:translateY(-6px) rotate(-45deg)}

    /* Drawer */
    .nav-overlay{display:none;position:fixed;inset:0;background:rgba(2,6,23,.4);z-index:55}
    .nav-links{position:fixed;top:64px;right:12px;left:12px;display:none;flex-direction:column;gap:8px;background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:12px;z-index:56}
    .nav.open .nav-overlay{display:block} .nav.open .nav-links{display:flex}
    @media(min-width:1024px){
      .burger{display:none} .nav-overlay{display:none!important}
      .nav-links{position:static;display:flex!important;flex-direction:row;background:transparent;border:0;box-shadow:none;padding:0;gap:8px}
    }

    /* LAYOUT */
    .layout{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:1024px){ .layout{grid-template-columns:260px 1fr} }
    .sidebar{display:none}
    @media(min-width:1024px){ .sidebar{display:block;position:sticky;top:64px;height:calc(100vh - 80px)} }
    .sidecard{border:1px solid var(--border);border-radius:12px;background:var(--card);padding:12px;box-shadow:var(--shadow)}
    .sidecard a{display:block;padding:6px 8px;border-radius:8px}
    .sidecard a:hover{background:var(--bg-soft)}

    /* GENERIC CAROUSEL */
    .carousel{position:relative;border:1px solid var(--border);border-radius:14px;overflow:hidden;background:var(--bg-soft);margin:18px 0}
    .frame{position:relative;width:100%;touch-action:pan-y}
    .track{display:flex;height:100%;transition:transform .5s ease}
    .slide{min-width:100%;height:100%}
    .ctrl{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;padding:0 6px;pointer-events:none}
    .ctrl button{background:rgba(0,0,0,.55);color:#fff;border:none;width:40px;height:40px;border-radius:999px;pointer-events:auto}
    .dots{position:absolute;left:0;right:0;bottom:8px;display:flex;gap:6px;justify-content:center}
    .dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.5)}
    .dot.active{background:#fff}

    /* HERO (landscape) */
    #carousel .frame{aspect-ratio:16/9}
    #carousel .slide img{width:100%;height:100%;object-fit:cover}
    #carousel .caption{position:absolute;left:12px;bottom:12px;background:rgba(0,0,0,.55);color:#fff;padding:6px 10px;border-radius:10px;font-size:14px}

    /* POSTER CAROUSEL (portrait) ‚Äî FULL BLEED + TAMPIL UTUH */
    #poster .card{padding:0;overflow:hidden}
    #poster .poster-caption{padding:12px}
    #posterCarousel{border:0}
    #posterCarousel .frame{aspect-ratio:3/4;max-height:540px;background:#fff}
    #posterCarousel .slide{display:flex;align-items:center;justify-content:center;padding:0}
    #posterCarousel .slide a{display:block;width:100%;height:100%}
    #posterCarousel .slide img{
      display:block;width:100%;height:100%;
      object-fit:var(--poster-fit);
      background:#fff;border:0;border-radius:0;box-shadow:none
    }
    #poster .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    #poster .topbar .muted{font-size:14px}

    /* CARDS + FOOTER */
    .section{padding:18px 0} .section h2{margin:0 0 10px}
    .cards{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.cards{grid-template-columns:repeat(2,1fr)}}
    .card{border:1px solid var(--border);border-radius:12px;background:var(--card);padding:12px;box-shadow:var(--shadow)}
    .card img{width:100%;border-radius:8px;margin-bottom:8px;display:block;object-fit:cover;max-height:380px}
    .muted{color:var(--muted)}
    footer{border-top:1px solid var(--border);padding:20px 0;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav" id="nav">
    <div class="nav-overlay" id="navOverlay" aria-hidden="true"></div>
    <div class="container nav-inner">
      <div class="brand"><img src="jm.jpeg" alt="JM"><span>Jepang Mengaji</span></div>
      <button class="burger" id="burger" aria-label="Buka menu" aria-controls="navLinks" aria-expanded="false"><span></span></button>
      <div class="nav-links" id="navLinks" role="menu">
        <a class="btn" href="#updates" role="menuitem">Info Terbaru</a>
        <a class="btn" href="#urgent" role="menuitem">Penting</a>
        <a class="btn" href="#poster" role="menuitem">Poster</a>
        <a class="btn" href="#artikel" role="menuitem">Artikel</a>
        <a class="btn" href="#kajian" role="menuitem">Kajian</a>
        <!-- BARU: menu Donasi + Konfirmasi -->
        <a class="btn primary" href="donasi.html" role="menuitem">Donasi</a>
        <a class="btn" href="konfirmasi.html" role="menuitem">Konfirmasi</a>
        <a class="btn" href="https://www.youtube.com/@JepangMengaji" target="_blank" role="menuitem" rel="noopener">Arsip YouTube</a>
      </div>
    </div>
  </nav>

  <div class="container layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidecard">
        <h3>Navigasi</h3>
        <a href="#updates">üÜï Info Terbaru</a>
        <a href="#urgent">‚ö†Ô∏è Pengumuman Penting</a>
        <a href="#poster">üñºÔ∏è Poster</a>
        <a href="#artikel">üìñ Artikel</a>
        <a href="#kajian">üìö Kajian</a>
        <a href="#donasi">‚ù§Ô∏è Donasi</a>
        <!-- BARU: link langsung ke halaman konfirmasi di repo -->
        <a href="konfirmasi.html">üì® Konfirmasi Donasi</a>
      </div>
    </aside>

    <main>
      <!-- HERO CAROUSEL -->
      <section class="carousel" id="carousel">
        <div class="frame" id="frame">
          <div class="track" id="track">
            <div class="slide"><img src="assets/slides/1.jpeg" alt="Slide 1"><div class="caption">Kegiatan 1</div></div>
            <div class="slide"><img src="assets/slides/2.jpeg" alt="Slide 2"><div class="caption">Kegiatan 2</div></div>
            <div class="slide"><img src="assets/slides/3.jpeg" alt="Slide 3"><div class="caption">Kegiatan 3</div></div>
          </div>
          <div class="ctrl"><button id="prev" aria-label="Sebelumnya">‚Äπ</button><button id="next" aria-label="Berikutnya">‚Ä∫</button></div>
          <div class="dots" id="dots"></div>
        </div>
      </section>

      <!-- POSTER CAROUSEL -->
      <section id="poster" class="section">
        <div class="topbar">
          <h2>Poster</h2>
          <a class="btn" href="https://drive.google.com/embeddedfolderview?id=1WJoNkSthbw1JZSdDp8d2bAVlXYvbCpaH#grid" target="_blank" rel="noopener">Lihat semua</a>
        </div>
        <div class="card">
          <div class="carousel" id="posterCarousel">
            <div class="frame" id="pFrame">
              <div class="track" id="pTrack">
                <!-- Fallback 1 slide (diganti otomatis bila feed tersedia) -->
                <div class="slide">
                  <a href="#" aria-label="Poster">
                    <img src="assets/slides/1.jpeg" alt="Poster">
                  </a>
                </div>
              </div>
              <div class="ctrl"><button id="pPrev" aria-label="Sebelumnya">‚Äπ</button><button id="pNext" aria-label="Berikutnya">‚Ä∫</button></div>
              <div class="dots" id="pDots"></div>
            </div>
          </div>
          <p class="poster-caption" id="posterNote">
            Untuk ihwah yang berkeluangan silahkan untuk <em>‚Äúbertaawun dalam donasi Dauroh Fuyu. Silakan bantu sebar poster ini.‚Äù</em>
          </p>
        </div>
      </section>

      <!-- Sections -->
      <section id="updates" class="section"><h2>Info Terbaru</h2><div id="updatesList" class="cards"></div></section>
      <section id="urgent" class="section"><h2>Pengumuman Penting</h2><div id="urgentList" class="cards"></div></section>
      <section id="artikel" class="section"><h2>Artikel</h2><div id="articlesList" class="cards"></div></section>
      <section id="kajian" class="section"><h2>Kajian</h2><div id="kajianList" class="cards"></div></section>

      <!-- BARU: SECTION DONASI + KONFIRMASI -->
      <section id="donasi" class="section">
        <h2>Donasi</h2>
        <div class="cards">
          <article class="card">
            <h3>Dukung Kegiatan Jepang Mengaji</h3>
            <p class="muted">Ingin ikut berkontribusi? Silakan menuju halaman donasi untuk rincian rekening dan cara berdonasi.</p>
            <a class="btn primary" href="donasi.html">Buka Halaman Donasi</a>
          </article>
          <article class="card">
            <h3>Konfirmasi Donasi</h3>
            <p class="muted">Sudah transfer? Agar tercatat dengan benar, mohon lakukan konfirmasi melalui halaman berikut.</p>
            <a class="btn" href="konfirmasi.html">Ke Halaman Konfirmasi</a>
          </article>
        </div>
      </section>
    </main>
  </div>

  <footer>¬© <span id="year"></span> Jepang Mengaji ‚Ä¢ Design by Wahyu</footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    /* ====== BURGER ====== */
    const nav=document.getElementById('nav'), burger=document.getElementById('burger'),
          navLinks=document.getElementById('navLinks'), navOverlay=document.getElementById('navOverlay');
    function closeNav(){ nav.classList.remove('open'); burger.setAttribute('aria-expanded','false'); }
    function openNav(){ nav.classList.add('open'); burger.setAttribute('aria-expanded','true'); }
    burger.addEventListener('click',()=> nav.classList.contains('open')?closeNav():openNav());
    navOverlay?.addEventListener('click', closeNav);
    window.addEventListener('keydown',e=>{ if(e.key==='Escape') closeNav(); });
    navLinks.querySelectorAll('a').forEach(a=>a.addEventListener('click', closeNav));

    /* ====== HERO CAROUSEL ====== */
    const track=document.getElementById('track'), dotsWrap=document.getElementById('dots'),
          frame=document.getElementById('frame');
    const slides=[...track.children]; let idx=0,timer=null,startX=null,dragging=false;
    function buildDots(){ dotsWrap.innerHTML=''; slides.forEach((_,i)=>{const b=document.createElement('button'); b.className='dot'+(i===idx?' active':''); b.onclick=()=>go(i,true); dotsWrap.appendChild(b);}); }
    function go(i,user){ idx=(i+slides.length)%slides.length; track.style.transform=`translateX(${-idx*100}%)`; [...dotsWrap.children].forEach((d,di)=>d.classList.toggle('active',di===idx)); if(user) restart(); }
    function nextSlide(){ go(idx+1,false); } function prevSlide(){ go(idx-1,true); }
    function restart(){ clearInterval(timer); timer=setInterval(nextSlide,5000); }
    document.getElementById('next').onclick=nextSlide; document.getElementById('prev').onclick=prevSlide; buildDots(); restart();
    frame.addEventListener('pointerdown', (e)=>{ startX=e.clientX; dragging=true; clearInterval(timer); frame.setPointerCapture(e.pointerId); });
    frame.addEventListener('pointerup', (e)=>{ if(!dragging) return; const dx=e.clientX-startX; const T=30; if(dx>T) prevSlide(); else if(dx<-T) nextSlide(); else restart(); dragging=false; startX=null; });
    frame.addEventListener('pointercancel', ()=>{ dragging=false; startX=null; restart(); });

    /* ====== POSTER CAROUSEL (from Drive feed) ====== */
    const DRIVE_FOLDER_ID = "1WJoNkSthbw1JZSdDp8d2bAVlXYvbCpaH";
    const DRIVE_FEED_BASE = "https://script.google.com/macros/s/AKfycbysSEyIHz3MSzJ20kjvbNMziMZrlEc6cMYELx9IRsmpTtHQHRPe864P7m_W7EgYN-Nagw/exec";
    const DRIVE_FEED = `${DRIVE_FEED_BASE}?id=${encodeURIComponent(DRIVE_FOLDER_ID)}`;

    const pTrack=document.getElementById('pTrack'), pDots=document.getElementById('pDots'), pFrame=document.getElementById('pFrame');
    const pPrev=document.getElementById('pPrev'), pNext=document.getElementById('pNext');
    let pIdx=0, pTimer=null, pStartX=null, pDragging=false;

    function pBuildDots(){
      const count = pTrack.children.length;
      pDots.innerHTML='';
      for(let i=0;i<count;i++){
        const b=document.createElement('button');
        b.className='dot'+(i===pIdx?' active':'');
        b.onclick=()=>pGo(i,true);
        pDots.appendChild(b);
      }
    }
    function pGo(i,user){
      const count = pTrack.children.length;
      pIdx=(i+count)%count;
      pTrack.style.transform=`translateX(${-pIdx*100}%)`;
      [...pDots.children].forEach((d,di)=>d.classList.toggle('active',di===pIdx));
      if(user) pRestart();
    }
    function pNextFn(){ pGo(pIdx+1,false); }
    function pPrevFn(){ pGo(pIdx-1,true); }
    function pRestart(){ clearInterval(pTimer); pTimer=setInterval(pNextFn,6000); }

    pPrev.onclick=pPrevFn; pNext.onclick=pNextFn;
    pFrame.addEventListener('pointerdown', (e)=>{ pStartX=e.clientX; pDragging=true; clearInterval(pTimer); pFrame.setPointerCapture(e.pointerId); });
    pFrame.addEventListener('pointerup', (e)=>{ if(!pDragging) return; const dx=e.clientX-pStartX; const T=30; if(dx>T) pPrevFn(); else if(dx<-T) pNextFn(); else pRestart(); pDragging=false; pStartX=null; });
    pFrame.addEventListener('pointercancel', ()=>{ pDragging=false; pStartX=null; pRestart(); });

    async function loadPosters(){
      try{
        if(!/^https?:\/\//.test(DRIVE_FEED)) throw new Error('Feed belum diset');
        const res = await fetch(DRIVE_FEED+"&_="+Date.now());
        const {files=[]} = await res.json();
        const items = files.filter(f=>/^image\//.test(f.mimeType)).slice(0,12);
        if(!items.length) throw new Error('Tidak ada gambar');

        // Thumbnail stabil untuk <img>; fallback ke direct jika gagal
        pTrack.innerHTML = items.map(f=>{
          const thumb = `https://drive.google.com/thumbnail?id=${f.id}&sz=w1200`;
          const direct = f.url || `https://drive.google.com/uc?export=view&id=${f.id}`;
          return `
            <div class="slide">
              <a href="${f.view || ('https://drive.google.com/file/d/'+f.id+'/view')}" target="_blank" rel="noopener" aria-label="${f.name}">
                <img src="${thumb}" alt="${f.name}" loading="lazy" decoding="async" draggable="false"
                     referrerpolicy="no-referrer"
                     onerror="this.onerror=null; this.src='${direct}';">
              </a>
            </div>
          `;
        }).join('');
      }catch(err){
        console.warn('Poster feed fallback:', err.message);
      }finally{
        pIdx=0; pBuildDots(); pRestart();
      }
    }
    loadPosters();

    /* ====== CSV SECTIONS ====== */
    const ARTICLES="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=0&single=true&output=csv";
    const KAJIAN="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=450885199&single=true&output=csv";
    const INFO="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=1656910010&single=true&output=csv";
    const PENTING="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=215662022&single=true&output=csv";

    async function fetchCSV(url){
      const res=await fetch(url+"&_="+Date.now());
      const text=(await res.text()).replace(/^\uFEFF/,'');
      const rows=[];let row=[],cell='',inQuotes=false;
      for(let i=0;i<text.length;i++){
        const c=text[i],n=text[i+1];
        if(c=='"'){ if(inQuotes&&n=='"'){cell+='"';i++;} else inQuotes=!inQuotes; }
        else if(c===','&&!inQuotes){row.push(cell);cell='';}
        else if((c==='\n'||(c==='\r'&&n==='\n'))&&!inQuotes){if(c==='\r')i++;row.push(cell);rows.push(row);row=[];cell='';}
        else cell+=c;
      }
      if(cell||row.length){row.push(cell);rows.push(row);}
      const header=(rows.shift()||[]).map(h=>h.trim().toLowerCase());
      return rows.map(r=>Object.fromEntries(header.map((h,i)=>[h,(r[i]||'').trim()])));
    }
    const pick=(o,keys)=>{for(const k of keys){const v=o[k];if(v&&v.trim()) return v;}return "";};
    function directImage(u){ if(!u) return ""; if(/drive\.google\.com/.test(u)){ const m=u.match(/\/d\/([^/]+)/)||u.match(/[?&]id=([^&]+)/); const id=m&&m[1]; if(id) return `https://drive.google.com/uc?export=view&id=${id}`;} return u; }
    function render(list,id,fallback){
      const wrap=document.getElementById(id); wrap.innerHTML="";
      if(!list.length){wrap.innerHTML='<div class="card muted">'+fallback+'</div>';return;}
      list.forEach(it=>{
        const el=document.createElement("article"); el.className="card";
        const poster = directImage(pick(it,["poster","gambar","image","foto","thumbnail","poster_url"]));
        const title  = pick(it,["title","judul","nama"]) || "(Tanpa judul)";
        const desc   = pick(it,["excerpt","konten","deskripsi","description"]);
        const date   = pick(it,["date","tanggal","tgl"]);
        const href   = pick(it,["href","link","url"]);
        el.innerHTML=`
          ${poster ? `<img src="${poster}" alt="Poster ${title}">` : ""}
          <h3>${title}</h3>
          ${desc ? `<p class="muted">${desc}</p>` : ""}
          ${date ? `<div class="muted">${date}</div>` : ""}
          ${href ? `<a class="btn" href="${href}" target="_blank" rel="noopener">Baca</a>` : ""}
        `;
        wrap.appendChild(el);
      });
    }
    (async()=>{
      render(await fetchCSV(INFO),"updatesList","Belum ada info.");
      render(await fetchCSV(PENTING),"urgentList","Belum ada pengumuman.");
      render(await fetchCSV(ARTICLES),"articlesList","Belum ada artikel.");
      render(await fetchCSV(KAJIAN),"kajianList","Belum ada kajian.");
    })();
  </script>
</body>
</html>
