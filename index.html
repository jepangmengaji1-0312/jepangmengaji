<!doctype html>
<html lang="id" data-theme="light" id="top">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jepang Mengaji ‚Äî Beranda</title>
  <meta name="description" content="Komunitas Jepang Mengaji: info terbaru, pengumuman penting, artikel, donasi & konfirmasi, serta arsip YouTube." />
  <link rel="icon" href="jm.jpeg" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <style>
    :root{
      --bg:#ffffff;--bg-soft:#f8fafc;--text:#0f172a;--muted:#556070;
      --card:#ffffff;--border:#e5e7eb;--primary:#ef4444;--accent:#0ea5e9;
      --shadow:0 10px 25px rgba(2,6,23,.06)
    }
    *{box-sizing:border-box} html,body{margin:0;height:100%} img{max-width:100%;display:block}
    body{
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial;
      color:var(--text); background:var(--bg);
    }
    /* BG watermark gradasi */
    body::before{
      content:""; position:fixed; inset:0; z-index:-2;
      background:linear-gradient(180deg,#fff 0%, #f6f8fb 50%, #eef2f7 100%);
    }
    body::after{
      content:"Jepang Mengaji"; position:fixed; z-index:-1; inset:0;
      display:flex; align-items:center; justify-content:center;
      font-weight:800; letter-spacing:.02em;
      color:#0f172a; opacity:.06; pointer-events:none;
      font-size:16vw; line-height:1; user-select:none;
    }

    a{color:inherit;text-decoration:none}
    .container{max-width:1180px;margin:0 auto;padding:0 16px}

    /* NAVBAR + burger */
    .nav{position:sticky;top:0;z-index:60;background:rgba(255,255,255,.92);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;min-width:0}
    .brand img{width:34px;height:34px;border-radius:8px;border:1px solid var(--border)}
    .brand span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:54vw}
    .nav-links{display:flex;gap:8px;list-style:none;margin:0;padding:0}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px;cursor:pointer;white-space:nowrap}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.ghost{background:transparent}
    .menu-btn{display:none;flex-direction:column;gap:4px;cursor:pointer}
    .menu-btn span{width:24px;height:3px;background:var(--text);border-radius:2px}
    @media(max-width:960px){
      .menu-btn{display:flex}
      .nav-links{display:none;flex-direction:column;position:absolute;top:100%;right:10px;background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:10px;width:220px}
      .nav-links.open{display:flex}
    }

    /* Channel header */
    .channel{border-bottom:1px solid var(--border);background:transparent}
    .banner{aspect-ratio:16/4;width:100%;background:linear-gradient(90deg,#0f172a,#1f2937);border-radius:0 0 14px 14px}
    .channel-bar{display:flex;align-items:center;gap:14px;padding:12px 0;flex-wrap:wrap}
    .avatar{width:72px;height:72px;border-radius:50%;border:3px solid #fff;box-shadow:0 2px 10px rgba(0,0,0,.08);object-fit:cover}
    .ch-meta{flex:1;min-width:220px}
    .ch-title{margin:0;font-size:22px;font-weight:800}
    .ch-sub{margin:.2rem 0 0;color:var(--muted);font-size:14px}

    /* HERO Carousel */
    .hero{padding:16px 0}
    .carousel{position:relative;border-radius:14px;overflow:hidden;border:1px solid var(--border);background:var(--bg-soft)}
    .frame{position:relative;width:100%;aspect-ratio:16/9}
    .track{display:flex;height:100%;transition:transform .5s ease;will-change:transform}
    .slide{min-width:100%;height:100%;position:relative}
    .slide img{width:100%;height:100%;object-fit:cover;object-position:center}
    .caption{position:absolute;left:10px;bottom:10px;background:rgba(0,0,0,.55);color:#fff;padding:6px 10px;border-radius:10px;font-size:13px;border:1px solid rgba(255,255,255,.25)}
    .ctrl{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;pointer-events:none;padding:0 6px}
    .ctrl button{pointer-events:auto;background:rgba(0,0,0,.55);color:#fff;border:1px solid rgba(255,255,255,.25);width:38px;height:38px;border-radius:999px}

    /* Sections */
    .section{padding:16px 0}
    .section h2{margin:0 0 10px}
    .grid{display:grid;gap:12px}
    .cards-3{grid-template-columns:1fr}
    @media(min-width:900px){.cards-3{grid-template-columns:repeat(3,1fr)}}
    .cards-2{grid-template-columns:1fr}
    @media(min-width:640px){.cards-2{grid-template-columns:repeat(2,1fr)}}
    .card{border:1px solid var(--border);border-radius:12px;background:var(--card);padding:12px}
    .muted{color:var(--muted)}
    .chip{font-size:.85rem;padding:.25rem .5rem;border-radius:.5rem;border:1px solid var(--border);background:var(--bg-soft)}
    input.btn, select.btn{background:#fff}

    footer{border-top:1px solid var(--border);padding:26px 0 40px;color:var(--muted)}
    .foot{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}

    /* Small tweaks mobile */
    @media(max-width:480px){
      .brand img{width:30px;height:30px} .brand span{font-size:16px;max-width:58vw}
      .btn{padding:7px 10px;font-size:14px}
      .caption{font-size:12px}
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav" aria-label="Navigasi">
    <div class="container nav-inner">
      <a class="brand" href="#top" aria-label="Beranda">
        <img src="jm.jpeg" alt="JM"/><span>Jepang Mengaji</span>
      </a>
      <div class="menu-btn" id="menuBtn" aria-label="Menu"><span></span><span></span><span></span></div>
      <ul class="nav-links" id="navLinks">
        <li><a class="btn ghost" href="#updates">Info Terbaru</a></li>
        <li><a class="btn ghost" href="#urgent">Penting</a></li>
        <li><a class="btn ghost" href="#artikel">Artikel</a></li>
        <li><a class="btn" href="#donasi">Donasi</a></li>
        <li><a class="btn primary" href="https://www.youtube.com/@jepangmengaji1390" target="_blank" rel="noopener">Arsip YouTube</a></li>
      </ul>
    </div>
  </nav>

  <!-- HEADER ala channel -->
  <header class="channel" role="banner">
    <div class="banner"></div>
    <div class="container channel-bar">
      <img class="avatar" src="jm.jpeg" alt="Logo Jepang Mengaji"/>
      <div class="ch-meta">
        <h1 class="ch-title">Jepang Mengaji</h1>
        <p class="ch-sub">Mengaji sesuai Sunnah ‚Ä¢ Kajian, artikel, dokumentasi & donasi</p>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <a class="btn primary" href="https://www.youtube.com/@jepangmengaji1390?sub_confirmation=1" target="_blank" rel="noopener">Subscribe</a>
        <a class="btn" href="#donasi">Donasi</a>
      </div>
    </div>
  </header>

  <main>
    <!-- HERO: Slideshow -->
    <section class="hero" aria-label="Dokumentasi kegiatan">
      <div class="container">
        <div class="carousel" id="carousel" role="region" aria-roledescription="carousel" aria-label="Foto Kegiatan">
          <div class="frame">
            <div class="track" id="track">
              <!-- Fallback: pakai file lokal -->
              <figure class="slide"><img src="assets/slides/1.jpeg" alt="Kegiatan 1"><figcaption class="caption">Kegiatan 1</figcaption></figure>
              <figure class="slide"><img src="assets/slides/2.jpeg" alt="Kegiatan 2"><figcaption class="caption">Kegiatan 2</figcaption></figure>
              <figure class="slide"><img src="assets/slides/3.jpeg" alt="Kegiatan 3"><figcaption class="caption">Kegiatan 3</figcaption></figure>
            </div>
            <div class="ctrl"><button id="prev" aria-label="Sebelumnya">‚Äπ</button><button id="next" aria-label="Berikutnya">‚Ä∫</button></div>
          </div>
        </div>
      </div>
    </section>

    <!-- DONASI & KONFIRMASI -->
    <section id="donasi" class="section">
      <div class="container grid cards-2" style="align-items:start">
        <article class="card">
          <h3>‚ù§Ô∏è Donasi Kegiatan</h3>
          <p class="muted">Dukung dakwah: operasional, dokumentasi, dan penyelenggaraan kajian.</p>
          <ul class="muted" style="line-height:1.7;margin:.4rem 0">
            <li>SMBC/Jenius a.n. <em>Wahyu Setiawan</em> ‚Äî
              <strong id="rek-jenius">90220139952</strong> <button class="chip" data-copy="#rek-jenius">Salin</button>
            </li>
            <li>Yucho Ginko a.n. <em>„Éà„É™„Çµ„É≥„Éú„Éâ</em> ‚Äî
              <strong id="rek-yucho">14660-20688191</strong> <button class="chip" data-copy="#rek-yucho">Salin</button>
            </li>
          </ul>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
            <a class="btn primary" href="donasi.html">üí≥ Link Donasi</a>
            <a class="btn" href="#konfirmasi">‚úÖ Konfirmasi Transfer</a>
          </div>
        </article>

        <article class="card" id="konfirmasi">
          <h3>‚úÖ Konfirmasi Transfer</h3>
          <p class="muted">Kirim format singkat via WhatsApp atau Email (otomatis tersusun).</p>
          <div style="display:grid;gap:8px;grid-template-columns:1fr 1fr">
            <input class="btn" id="kf-nama" placeholder="Nama">
            <input class="btn" id="kf-nominal" placeholder="Nominal (cth 100000)">
            <input class="btn" id="kf-tanggal" type="date">
            <select class="btn" id="kf-bank">
              <option value="">Transfer ke</option>
              <option>SMBC / Jenius</option><option>Yucho</option>
            </select>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
            <button class="btn primary" id="btnWA">Kirim via WhatsApp</button>
            <a class="btn" id="btnEmail" href="#">Kirim via Email</a>
          </div>
        </article>
      </div>
    </section>

    <!-- INFO TERBARU -->
    <section id="updates" class="section">
      <div class="container">
        <h2>Info Terbaru</h2>
        <div id="updatesList" class="grid cards-3"></div>
      </div>
    </section>

    <!-- PENGUMUMAN PENTING -->
    <section id="urgent" class="section" style="background:var(--bg-soft);">
      <div class="container">
        <h2>Pengumuman Penting</h2>
        <div id="urgentList" class="grid cards-2"></div>
      </div>
    </section>

    <!-- ARTIKEL -->
    <section id="artikel" class="section">
      <div class="container">
        <h2>Artikel</h2>
        <div id="articlesList" class="grid cards-3"></div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container foot">
      <div>¬© <span id="year"></span> Jepang Mengaji</div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span class="muted chip">Design by Wahyu</span>
        <a class="muted" href="https://www.youtube.com/@jepangmengaji1390" target="_blank" rel="noopener">‚ñ∂Ô∏è Arsip YouTube</a>
        <a class="muted" href="#top">‚Üë Ke atas</a>
      </div>
    </div>
  </footer>

  <script>
    // ===== YEAR
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== Burger
    const menuBtn=document.getElementById('menuBtn');
    const navLinks=document.getElementById('navLinks');
    menuBtn.addEventListener('click',()=>navLinks.classList.toggle('open'));
    document.addEventListener('click',e=>{
      if(!e.target.closest('.nav') && navLinks.classList.contains('open')) navLinks.classList.remove('open');
    });

    // ===== Copy rekening
    function copySel(sel){
      const el=document.querySelector(sel);
      if(!el) return;
      navigator.clipboard.writeText(el.textContent.trim()).then(()=>alert('Nomor rekening tersalin'),()=>alert('Gagal menyalin'));
    }
    document.addEventListener('click',e=>{
      const btn=e.target.closest('.chip[data-copy]'); if(!btn) return;
      copySel(btn.getAttribute('data-copy'));
    });

    // ===== Konfirmasi Transfer (WA/Email)
    function buildKonfirmasi(){
      const nama=(document.getElementById('kf-nama')||{}).value||'';
      const nominal=(document.getElementById('kf-nominal')||{}).value||'';
      const tgl=(document.getElementById('kf-tanggal')||{}).value||'';
      const bank=(document.getElementById('kf-bank')||{}).value||'';
      return [
        "Assalamu'alaikum, saya ingin konfirmasi transfer.",
        `Nama: ${nama||'-'}`,
        `Nominal: ${nominal||'-'}`,
        `Tanggal: ${tgl||'-'}`,
        `Transfer ke: ${bank||'-'}`
      ].join('\n');
    }
    document.getElementById('btnWA')?.addEventListener('click',()=>{
      const msg=encodeURIComponent(buildKonfirmasi());
      window.open(`https://wa.me/817084810427?text=${msg}`,'_blank','noopener');
    });
    document.getElementById('btnEmail')?.addEventListener('click',e=>{
      const body=encodeURIComponent(buildKonfirmasi());
      e.currentTarget.href=`mailto:jepangmengaji@gmail.com?subject=Konfirmasi%20Transfer&body=${body}`;
    });

    // ===== Carousel
    const track=document.getElementById('track');
    const slides=Array.from(track.children);
    const prev=document.getElementById('prev');
    const next=document.getElementById('next');
    let index=0, timer=null, touchStartX=0, dragging=false;

    function go(i){ index=(i+slides.length)%slides.length; track.style.transform=`translateX(${-index*100}%)`; }
    function nextSlide(){ go(index+1); }
    function prevSlide(){ go(index-1); }
    function restart(){ clearInterval(timer); timer=setInterval(nextSlide, 5000); }

    next.addEventListener('click',()=>{ nextSlide(); restart(); });
    prev.addEventListener('click',()=>{ prevSlide(); restart(); });

    // swipe
    track.addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX; dragging=true; clearInterval(timer);},{passive:true});
    track.addEventListener('touchend',e=>{ if(!dragging) return; dragging=false; const dx=e.changedTouches[0].clientX-touchStartX; if(Math.abs(dx)>60){ dx<0?nextSlide():prevSlide(); } else { go(index); } restart();},{passive:true});
    restart();

    // ===== Data sources (Google Sheets CSV)
    const ARTICLES_CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=0&single=true&output=csv";
    const INFO_CSV_URL    ="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=1656910010&single=true&output=csv";
    const URGENT_CSV_URL  ="https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=215662022&single=true&output=csv";

    async function fetchCSV(url){
      const res=await fetch(url+(url.includes('?')?'&':'?')+'_'+Date.now());
      const text=(await res.text()).replace(/^\\uFEFF/,'');
      const rows=[]; let row=[],cell='',inQuotes=false;
      for(let i=0;i<text.length;i++){
        const c=text[i], n=text[i+1];
        if(c=='\"'){ if(inQuotes && n=='\"'){ cell+='\"'; i++; } else inQuotes=!inQuotes; }
        else if(c===',' && !inQuotes){ row.push(cell); cell=''; }
        else if((c==='\\n' || (c==='\\r'&&n==='\\n')) && !inQuotes){
          if(c==='\\r') i++; row.push(cell); cell=''; if(row.length) rows.push(row); row=[];
        } else { cell+=c; }
      }
      if(cell||row.length){ row.push(cell); rows.push(row); }
      const header=(rows.shift()||[]).map(h=>h.trim().toLowerCase());
      return rows.map(r=>Object.fromEntries(header.map((h,i)=>[h,(r[i]||'').trim()])));
    }
    const pick=(o,keys)=>{ for(const k of keys){ const v=o[k]; if(v && String(v).trim()) return String(v).trim(); } return ""; };

    function renderUpdates(list){
      const wrap=document.getElementById('updatesList'); wrap.innerHTML='';
      if(!list.length){ wrap.innerHTML='<div class="card muted">Belum ada info / gagal memuat.</div>'; return; }
      list.slice(0,6).forEach(it=>{
        const el=document.createElement('article'); el.className='card';
        el.innerHTML=`
          <h3 style="margin:.2rem 0">${it.title||'Info'}</h3>
          ${it.desc?`<p class="muted" style="margin:.2rem 0">${it.desc}</p>`:''}
          <div class="muted">${it.date?new Date(it.date).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}):''}</div>
          ${it.href?`<a class="btn" style="margin-top:8px" href="${it.href}" ${/^https?:/i.test(it.href)?'target="_blank" rel="noopener"':''}>Baca</a>`:''}
        `;
        wrap.appendChild(el);
      });
    }
    function renderUrgent(list){
      const wrap=document.getElementById('urgentList'); wrap.innerHTML='';
      if(!list.length){ wrap.innerHTML='<div class="card muted">Belum ada pengumuman / set dulu sheet Penting.</div>'; return; }
      list.slice(0,4).forEach(it=>{
        const el=document.createElement('article'); el.className='card';
        el.innerHTML=`
          <h3 style="margin:.2rem 0">${it.title||'Pengumuman'}</h3>
          ${it.desc?`<p class="muted" style="margin:.2rem 0">${it.desc}</p>`:''}
          <div class="muted">${it.date?new Date(it.date).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}):''}</div>
        `;
        wrap.appendChild(el);
      });
    }
    function renderArticles(list){
      const wrap=document.getElementById('articlesList'); wrap.innerHTML='';
      if(!list.length){ wrap.innerHTML='<div class="card muted">Belum ada artikel / gagal memuat.</div>'; return; }
      list.slice(0,6).forEach(a=>{
        const el=document.createElement('article'); el.className='card';
        el.innerHTML=`
          <h3 style="margin:.2rem 0">${a.title||''}</h3>
          ${a.excerpt?`<p class="muted" style="margin:.2rem 0">${a.excerpt}</p>`:''}
          <div class="muted">${a.date?new Date(a.date).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}):''}</div>
          ${a.href?`<a class="btn" style="margin-top:8px" href="${a.href}" ${/^https?:/i.test(a.href)?'target="_blank" rel="noopener"':''}>Baca</a>`:''}
        `;
        wrap.appendChild(el);
      });
    }

    async function loadSections(){
      try{
        const rows=await fetchCSV(INFO_CSV_URL);
        const items=rows.map(r=>({
          title:pick(r,['judul','title','nama']),
          date: pick(r,['tanggal','date','tgl','waktu']),
          href: pick(r,['href','link','url']),
          desc: pick(r,['konten','content','deskripsi','desc','ringkasan'])
        })).filter(x=>x.title||x.desc||x.href)
          .sort((a,b)=>new Date(b.date||0)-new Date(a.date||0));
        renderUpdates(items);
      }catch(e){ console.warn('Info error',e); renderUpdates([]); }

      try{
        const rows=await fetchCSV(URGENT_CSV_URL);
        const items=rows.map(r=>({
          title:pick(r,['judul','title','pengumuman']),
          date: pick(r,['tanggal','date','tgl']),
          desc: pick(r,['konten','content','deskripsi','desc','ringkasan'])
        })).filter(x=>x.title||x.desc)
          .sort((a,b)=>new Date(b.date||0)-new Date(a.date||0));
        renderUrgent(items);
      }catch(e){ console.warn('Urgent error',e); renderUrgent([]); }

      try{
        const rows=await fetchCSV(ARTICLES_CSV_URL);
        const items=rows.map(r=>({
          title: pick(r,['title','judul','nama','artikel']),
          excerpt: pick(r,['excerpt','ringkasan','deskripsi','desc','konten','content']),
          date: pick(r,['date','tanggal','published','tgl']),
          href: pick(r,['href','link','url'])
        })).filter(x=>x.title||x.href)
          .sort((a,b)=>new Date(b.date||0)-new Date(a.date||0));
        renderArticles(items);
      }catch(e){ console.warn('Artikel error',e); renderArticles([]); }
    }
    loadSections();

    /* OPTIONAL: pakai slides.json untuk kontrol slideshow
       Buat file slides.json di root repo dengan format:
       [
         {"src":"assets/slides/1.jpeg","caption":"Kegiatan 1"},
         {"src":"assets/slides/2.jpeg","caption":"Kegiatan 2"}
       ]
       Aktifkan kode ini kalau mau override fallback:
    */
    (async function trySlidesJson(){
      try{
        const res=await fetch('slides.json?_'+Date.now());
        if(!res.ok) return;
        const data=await res.json();
        if(!Array.isArray(data)||!data.length) return;
        const t=document.getElementById('track');
        t.innerHTML='';
        data.forEach((s,i)=>{
          const fig=document.createElement('figure');
          fig.className='slide';
          fig.innerHTML=`<img src="${s.src}" alt="${s.caption||('Kegiatan '+(i+1))}"><figcaption class="caption">${s.caption||('Kegiatan '+(i+1))}</figcaption>`;
          t.appendChild(fig);
        });
        // reset index
        go(0);
      }catch(_){ /* gunakan fallback */ }
    })();
  </script>
</body>
</html>
