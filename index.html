<!doctype html>
<html lang="id" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jepang Mengaji„ÄÄ„Ç≥„Éü„É•„Éã„ÉÜ„Ç£ ‚Äî Beranda</title>
  <meta name="description" content="Slideshow kegiatan, info & pengumuman dari Spreadsheet, donasi dan konfirmasi transfer." />
  <link rel="icon" href="jm.jpeg" />
  <style>
    :root{--bg:#fff;--bg-soft:#f8fafc;--text:#0f172a;--muted:#475569;--card:#fff;--border:#e5e7eb;--primary:#ef4444;--accent:#0ea5e9;--shadow:0 6px 24px rgba(2,6,23,.08)}
    *{box-sizing:border-box}
    html,body{margin:0;height:100%}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    img{display:block;max-width:100%}
    .container{max-width:1180px;margin:0 auto;padding:0 16px}

    .nav{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.92);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .nav-inner{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 0}
    .brand{display:flex;gap:10px;align-items:center;font-weight:800}
    .brand img{width:36px;height:36px;border-radius:8px;border:1px solid var(--border)}
    .nav-links{display:flex;gap:8px;align-items:center;overflow:auto}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px;cursor:pointer}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn.ghost{background:transparent}

    .layout{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:1024px){ .layout{grid-template-columns:260px 1fr} }
    .sidebar{display:none}
    @media(min-width:1024px){ .sidebar{display:block;position:sticky;top:64px;height:calc(100vh - 80px)} }
    .sidecard{border:1px solid var(--border);border-radius:12px;background:var(--card);padding:12px;box-shadow:var(--shadow)}
    .sidecard h3{margin:4px 0 8px;font-size:15px}
    .sidecard a{display:block;padding:8px;border-radius:8px}
    .sidecard a:hover{background:var(--bg-soft)}

    .hero{padding:14px 0}
    .carousel{position:relative;border:1px solid var(--border);border-radius:14px;overflow:hidden;background:var(--bg-soft)}
    .frame{aspect-ratio:16/9;position:relative;width:100%}
    .track{position:relative;width:100%;height:100%}
    .slide{position:absolute;inset:0;opacity:0;transition:opacity .6s ease}
    .slide.active{opacity:1}
    .slide img{width:100%;height:100%;object-fit:cover}
    .caption{position:absolute;left:12px;bottom:12px;background:rgba(0,0,0,.55);color:#fff;padding:8px 10px;border-radius:10px;font-size:14px}
    .ctrl{position:absolute;inset:0;display:flex;justify-content:space-between;align-items:center;padding:0 6px;pointer-events:none}
    .ctrl button{pointer-events:auto;background:rgba(0,0,0,.55);color:#fff;border:1px solid rgba(255,255,255,.25);width:40px;height:40px;border-radius:999px}
    .dots{position:absolute;left:0;right:0;bottom:8px;display:flex;gap:6px;justify-content:center}
    .dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.5);border:none}
    .dot.active{background:#fff}
    .slide-error{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;text-align:center;padding:14px;color:#991b1b;background:#fee2e2}

    .section{padding:18px 0}
    .section h2{margin:0 0 10px}
    .cards{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.cards{grid-template-columns:repeat(2,1fr)}}
    .cards-3{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){.cards-3{grid-template-columns:repeat(3,1fr)}}
    .card{border:1px solid var(--border);border-radius:12px;background:var(--card);padding:12px}
    .muted{color:var(--muted)}

    footer{border-top:1px solid var(--border);padding:26px 0 40px;color:var(--muted)}
    .foot{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .copy{font-size:.85rem;padding:.25rem .5rem;border-radius:.5rem;border:1px solid var(--border);background:var(--bg-soft)}
    input.btn, select.btn{background:#fff}
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <nav class="nav">
    <div class="container nav-inner">
      <div class="brand"><img src="jm.jpeg" alt="JM"><span>Jepang Mengaji</span></div>
      <div class="nav-links">
        <a class="btn ghost" href="#updates">Info Terbaru</a>
        <a class="btn ghost" href="#urgent">Penting</a>
        <a class="btn ghost" href="#artikel">Artikel</a>
        <a class="btn ghost" href="#donasi">Donasi</a>
        <a class="btn primary" href="https://www.youtube.com/@jepangmengaji1390" target="_blank" rel="noopener">Arsip YouTube</a>
      </div>
    </div>
  </nav>

  <div class="container layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidecard">
        <h3>Navigasi</h3>
        <a href="#updates">üÜï Info Terbaru</a>
        <a href="#urgent">‚ö†Ô∏è Pengumuman Penting</a>
        <a href="#artikel">üìñ Artikel</a>
        <a href="#donasi">‚ù§Ô∏è Donasi & Konfirmasi</a>
        <a href="https://www.youtube.com/@jepangmengaji1390" target="_blank" rel="noopener">‚ñ∂Ô∏è Arsip YouTube</a>
        <hr style="border:none;border-top:1px solid var(--border);margin:8px 0">
        <a href="https://chat.whatsapp.com/Fg2UKlhT5s9B7oYeTsMMKO?mode=ac_t" target="_blank" rel="noopener">üì≤ WhatsApp Group</a>
        <a href="https://t.me/jepangmengaji_channel" target="_blank" rel="noopener">üì£ Telegram Channel</a>
        <a href="mailto:jepangmengaji@gmail.com">‚úâÔ∏è Email</a>
      </div>
    </aside>

    <main>
      <!-- HERO: Slideshow dari repo -->
      <section class="hero" aria-label="Dokumentasi kegiatan">
        <div class="carousel" role="region" aria-roledescription="carousel" aria-label="Foto Kegiatan">
          <div class="frame">
            <div class="track" id="track"></div>
            <div class="ctrl"><button id="prev" aria-label="Sebelumnya">‚Äπ</button><button id="next" aria-label="Berikutnya">‚Ä∫</button></div>
            <div class="dots" id="dots"></div>
          </div>
        </div>
      </section>

      <!-- DONASI & KONFIRMASI -->
      <section id="donasi" class="section">
        <div class="cards">
          <div class="card">
            <h3>‚ù§Ô∏è Donasi Kegiatan</h3>
            <p class="muted">Dukung dakwah: operasional, dokumentasi, dan penyelenggaraan kajian.</p>
            <ul class="muted" style="line-height:1.7;margin:.4rem 0">
              <li>SMBC/Jenius a.n. <em>Wahyu Setiawan</em> ‚Äî <strong id="rek-jenius">90220139952</strong> <button class="copy" data-copy="#rek-jenius">Salin</button></li>
              <li>Yucho Ginko a.n. <em>„Éà„É™„Çµ„É≥„Éú„Éâ</em> ‚Äî <strong id="rek-yucho">14660-20688191</strong> <button class="copy" data-copy="#rek-yucho">Salin</button></li>
            </ul>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
              <a class="btn" href="#konfirmasi">‚úÖ Konfirmasi Transfer</a>
              <a class="btn" href="https://www.youtube.com/@jepangmengaji1390" target="_blank" rel="noopener">‚ñ∂Ô∏è Arsip YouTube</a>
            </div>
          </div>

          <div class="card" id="konfirmasi">
            <h3>‚úÖ Konfirmasi Transfer</h3>
            <p class="muted">Kirim format singkat via WhatsApp atau Email (otomatis tersusun).</p>
            <div style="display:grid;gap:8px;grid-template-columns:1fr 1fr">
              <input class="btn" id="kf-nama" placeholder="Nama"/>
              <input class="btn" id="kf-nominal" placeholder="Nominal (cth 100000)"/>
              <input class="btn" id="kf-tanggal" type="date"/>
              <select class="btn" id="kf-bank">
                <option value="">Transfer ke</option><option>SMBC / Jenius</option><option>Yucho</option>
              </select>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
              <button class="btn primary" id="btnWA">Kirim via WhatsApp</button>
              <a class="btn" id="btnEmail" href="#">Kirim via Email</a>
            </div>
          </div>
        </div>
      </section>

      <!-- INFO TERBARU -->
      <section id="updates" class="section">
        <h2>Info Terbaru</h2>
        <div id="updatesList" class="cards-3"></div>
      </section>

      <!-- PENGUMUMAN PENTING -->
      <section id="urgent" class="section" style="background:var(--bg-soft);border:1px solid var(--border);border-radius:12px;padding:16px">
        <h2>Pengumuman Penting</h2>
        <div id="urgentList" class="cards"></div>
      </section>

      <!-- ARTIKEL -->
      <section id="artikel" class="section">
        <h2>Artikel</h2>
        <div id="articlesList" class="cards-3"></div>
      </section>
    </main>
  </div>

  <footer>
    <div class="container foot">
      <div>¬© <span id="year"></span> Jepang Mengaji</div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <span class="muted copy">Design by Wahyu</span>
        <a class="muted" href="https://www.youtube.com/@jepangmengaji1390" target="_blank" rel="noopener">‚ñ∂Ô∏è Arsip YouTube</a>
        <a class="muted" href="mailto:jepangmengaji@gmail.com">‚úâÔ∏è Email</a>
      </div>
    </div>
  </footer>

  <script>
    // ===== Footer year =====
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== Copy rekening =====
    function copySel(sel){
      const el=document.querySelector(sel);
      if(!el) return;
      navigator.clipboard.writeText(el.textContent.trim()).then(()=>alert('Nomor rekening tersalin'),()=>alert('Gagal menyalin'));
    }
    document.addEventListener('click',e=>{
      const btn=e.target.closest('.copy[data-copy]');
      if(!btn) return;
      copySel(btn.getAttribute('data-copy'));
    });

    // ===== Konfirmasi Transfer (WA/Email)
    function buildKonfirmasi(){
      const nama=(document.getElementById('kf-nama')||{}).value||'';
      const nominal=(document.getElementById('kf-nominal')||{}).value||'';
      const tgl=(document.getElementById('kf-tanggal')||{}).value||'';
      const bank=(document.getElementById('kf-bank')||{}).value||'';
      return [
        "Assalamu'alaikum, saya ingin konfirmasi transfer.",
        `Nama: ${nama||'-'}`,
        `Nominal: ${nominal||'-'}`,
        `Tanggal: ${tgl||'-'}`,
        `Transfer ke: ${bank||'-'}`
      ].join('\n');
    }
    const btnWA=document.getElementById('btnWA');
    const btnEmail=document.getElementById('btnEmail');
    if(btnWA){ btnWA.addEventListener('click',()=>{ const msg=encodeURIComponent(buildKonfirmasi()); window.open(`https://wa.me/817084810427?text=${msg}`,'_blank','noopener'); });}
    if(btnEmail){ btnEmail.addEventListener('click',e=>{ const body=encodeURIComponent(buildKonfirmasi()); e.currentTarget.href=`mailto:jepangmengaji@gmail.com?subject=Konfirmasi%20Transfer&body=${body}`; });

    }

    /* ==========================
       SLIDESHOW dari repo (slides.json)
       ========================== */
    const SLIDES_JSON_URL = 'slides.json'; // file daftar gambar

    function showSlideError(msg){
      const track = document.getElementById('track');
      if(!track) return;
      track.innerHTML = `<div class="slide-error">
        <div>
          <strong>Slideshow tidak dapat memuat gambar.</strong><br/>
          <small>${msg}</small><br/><br/>
          <button id="retry" class="btn">Coba lagi</button>
        </div>
      </div>`;
      document.getElementById('retry')?.addEventListener('click', ()=> initSlideshow());
    }

    async function initSlideshow(){
      const track = document.getElementById('track');
      const dots  = document.getElementById('dots');
      const nextB = document.getElementById('next');
      const prevB = document.getElementById('prev');
      if(!track || !dots) return;

      let slidesData = [];
      try{
        const res = await fetch(SLIDES_JSON_URL + '?_=' + Date.now());
        if(!res.ok) throw new Error(res.status+' '+res.statusText);
        slidesData = await res.json(); // [{src, caption}]
      }catch(e){
        console.error('slides.json error:', e);
        showSlideError('Pastikan file slides.json ada di root repo & valid JSON.');
        return;
      }
      if(!Array.isArray(slidesData) || !slidesData.length){
        showSlideError('slides.json kosong. Tambahkan minimal 1 gambar.');
        return;
      }

      track.innerHTML = '';
      slidesData.forEach((f,i)=>{
        const fig = document.createElement('figure');
        fig.className = 'slide' + (i===0?' active':'');
        const src = f.src || '';
        const cap = f.caption || ('Kegiatan ' + (i+1));
        fig.innerHTML = `
          <img src="${src}" alt="${cap}">
          <figcaption class="caption">${cap}</figcaption>
        `;
        track.appendChild(fig);
      });

      dots.innerHTML='';
      slidesData.forEach((_,i)=>{
        const b=document.createElement('button');
        b.className='dot'+(i===0?' active':'');
        b.addEventListener('click',()=>go(i,true));
        dots.appendChild(b);
      });

      let idx=0, timer=null;
      const slides=[...track.children];

      function show(i){
        slides.forEach((s,si)=>s.classList.toggle('active', si===i));
        [...dots.children].forEach((d,di)=>d.classList.toggle('active', di===i));
      }
      function go(i,user){
        const n=slides.length; idx=(i+n)%n; show(idx); if(user) restart();
      }
      function next(){ go(idx+1,false); }
      function prev(){ go(idx-1,true); }
      function restart(){ clearInterval(timer); timer=setInterval(next, 5000); }
      nextB?.addEventListener('click', next);
      prevB?.addEventListener('click', prev);

      const frame=document.querySelector('.frame');
      frame?.addEventListener('mouseenter',()=>clearInterval(timer));
      frame?.addEventListener('mouseleave',restart);

      restart();
    }
    initSlideshow();

    /* ==========================
       CSV helpers + sections (Spreadsheet)
       ========================== */
    const ARTICLES_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=0&single=true&output=csv";
    const INFO_CSV_URL     = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=1656910010&single=true&output=csv";
    const URGENT_CSV_URL   = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQiIOueuc-YygpdulT9x9ZjJUA2jlaWXu2uGzwgHcugNebW5HLjR66luq3kHmqDvTmNJlSjpjsIQ6PG/pub?gid=215662022&single=true&output=csv";

    async function fetchCSV(url){
      const res = await fetch(url + (url.includes("?") ? "&" : "?") + "_=" + Date.now());
      const text = (await res.text()).replace(/^\uFEFF/,'');
      const rows = []; let row=[], cell='', inQuotes=false;
      for (let i=0;i<text.length;i++){
        const c=text[i], n=text[i+1];
        if(c=='"'){ if(inQuotes && n=='"'){ cell+='"'; i++; } else inQuotes=!inQuotes; }
        else if(c===',' && !inQuotes){ row.push(cell); cell=''; }
        else if((c==='\n' || (c==='\r'&&n==='\n')) && !inQuotes){
          if(c==='\r') i++; row.push(cell); cell=''; if(row.length) rows.push(row); row=[];
        } else { cell+=c; }
      }
      if(cell || row.length){ row.push(cell); rows.push(row); }
      const header = (rows.shift()||[]).map(h=>h.trim().toLowerCase());
      return rows.map(r => Object.fromEntries(header.map((h,i)=>[h,(r[i]||'').trim()])));
    }
    const pick = (o,keys)=>{ for(const k of keys){ const v=o[k]; if(v && String(v).trim()) return String(v).trim(); } return ""; };

    function renderUpdates(list){
      const wrap=document.getElementById('updatesList'); wrap.innerHTML='';
      if(!list.length){ wrap.innerHTML='<div class="card"><p class="muted">Belum ada info / gagal memuat.</p></div>'; return; }
      list.slice(0,6).forEach(it=>{
        const el=document.createElement('article'); el.className='card';
        el.innerHTML = `
          <h3 style="margin:.2rem 0">${it.title||'Info'}</h3>
          ${it.desc?`<p class="muted" style="margin:.2rem 0">${it.desc}</p>`:''}
          <div class="muted">${it.date?new Date(it.date).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}):''}</div>
          ${it.href?`<a class="btn" style="margin-top:8px" href="${it.href}" ${/^https?:/i.test(it.href)?'target="_blank" rel="noopener"':''}>Baca</a>`:''}
        `; wrap.appendChild(el);
      });
    }
    function renderUrgent(list){
      const wrap=document.getElementById('urgentList'); wrap.innerHTML='';
      if(!list.length){ wrap.innerHTML='<div class="card"><p class="muted">Belum ada pengumuman / set dulu sheet Penting.</p></div>'; return; }
      list.slice(0,4).forEach(it=>{
        const el=document.createElement('article'); el.className='card';
        el.innerHTML = `
          <h3 style="margin:.2rem 0">${it.title||'Pengumuman'}</h3>
          ${it.desc?`<p class="muted" style="margin:.2rem 0">${it.desc}</p>`:''}
          <div class="muted">${it.date?new Date(it.date).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}):''}</div>
        `; wrap.appendChild(el);
      });
    }
    function renderArticles(list){
      const wrap=document.getElementById('articlesList'); wrap.innerHTML='';
      if(!list.length){ wrap.innerHTML='<div class="card"><p class="muted">Belum ada artikel / gagal memuat.</p></div>'; return; }
      list.slice(0,6).forEach(a=>{
        const el=document.createElement('article'); el.className='card';
        el.innerHTML=`
          <h3 style="margin:.2rem 0">${a.title||''}</h3>
          ${a.excerpt?`<p class="muted" style="margin:.2rem 0">${a.excerpt}</p>`:''}
          <div class="muted">${a.date?new Date(a.date).toLocaleDateString('ja-JP',{year:'numeric',month:'short',day:'numeric'}):''}</div>
          ${a.href?`<a class="btn" style="margin-top:8px" href="${a.href}" ${/^https?:/i.test(a.href)?'target="_blank" rel="noopener"':''}>Baca</a>`:''}
        `;
        wrap.appendChild(el);
      });
    }

    async function loadSections(){
      try{
        const rows = await fetchCSV(INFO_CSV_URL);
        const items = rows.map(r=>({
          title: pick(r,['judul','title','nama']),
          date:  pick(r,['tanggal','date','tgl','waktu']),
          href:  pick(r,['href','link','url']),
          desc:  pick(r,['konten','content','deskripsi','desc','ringkasan'])
        })).filter(x=>x.title||x.desc||x.href)
          .sort((a,b)=>new Date(b.date||0)-new Date(a.date||0));
        renderUpdates(items);
      }catch(e){ console.warn('Info error', e); renderUpdates([]); }

      try{
        const rows = await fetchCSV(URGENT_CSV_URL);
        const items = rows.map(r=>({
          title: pick(r,['judul','title','pengumuman']),
          date:  pick(r,['tanggal','date','tgl']),
          desc:  pick(r,['konten','content','deskripsi','desc','ringkasan'])
        })).filter(x=>x.title||x.desc)
          .sort((a,b)=>new Date(b.date||0)-new Date(a.date||0));
        renderUrgent(items);
      }catch(e){ console.warn('Urgent error', e); renderUrgent([]); }

      try{
        const rows = await fetchCSV(ARTICLES_CSV_URL);
        const items = rows.map(r=>({
          title: pick(r,['title','judul','nama','artikel']),
          excerpt: pick(r,['excerpt','ringkasan','deskripsi','desc','konten','content']),
          date: pick(r,['date','tanggal','published','tgl']),
          href: pick(r,['href','link','url'])
        })).filter(x=>x.title||x.href)
          .sort((a,b)=>new Date(b.date||0)-new Date(a.date||0));
        renderArticles(items);
      }catch(e){ console.warn('Artikel error', e); renderArticles([]); }
    }
    loadSections();
  </script>
</body>
</html>
